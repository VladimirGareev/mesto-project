(()=>{"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;e?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled="disabled")},n=function(n){var o=document.querySelectorAll(n.formSelector);Array.from(o).forEach((function(o){!function(n,o){var r,c=n.querySelectorAll(o.inputSelector),a=n.querySelector(o.submitButtonSelector);e(a,n.checkValidity(),o),n.addEventListener("submit",(function(t){t.preventDefault()})),(r=c,function(e){if(Array.isArray(e))return t(e)}(r)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(e,n):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).forEach((function(t){t.addEventListener("input",(function(r){!function(t,e,n){var o=t.validity.valid,r=e.querySelector("#".concat(t.id,"-error"));o?function(t,e,n){e.classList.remove(n.inputErrorClass),t.textContent=e.validationMessage}(r,t,n):function(t,e,n){e.classList.add(n.inputErrorClass),t.textContent=e.validationMessage}(r,t,n)}(t,n,o),e(a,n.checkValidity(),o)}))}))}(o,n)}))};function o(t){"Escape"===t.key&&c(document.querySelector(".popup_opened"))}function r(t){t.classList.add("popup_opened"),document.addEventListener("keydown",o)}function c(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",o)}function a(t,e,n){n.querySelector("".concat(e.submitButtonSelector)).textContent=t?"Сохранение...":"Сохранить"}var i={url:"https://mesto.nomoreparties.co/v1/plus-cohort-13",headers:{authorization:"f2618b0f-750a-406d-b0d6-73ba336df905","Content-type":"application/json"}},u=function(t){return t.ok?t.json():Promise.reject(t)},s=document.querySelector("#photoAdd").content,l=document.querySelector(".photo-grid"),d=document.querySelector(".popup-pic"),p=d.querySelector(".popup-pic__picture"),f=d.querySelector(".popup-pic__heading");function h(t){l.prepend(t)}function m(t,e){var n=s.querySelector(".photo-grid__figure").cloneNode(!0),o=n.querySelector(".photo-grid__photo"),c=n.querySelector(".photo-grid__likes");return o.src=t.link,o.alt=t.name,o.id=t._id,c.textContent=t.likes.length,n.querySelector(".photo-grid__caption").textContent=t.name,t.owner._id!==e&&n.querySelector(".photo-grid__bin").classList.add("photo-grid__bin_inactive"),t.likes.some((function(t){return t._id===e}))&&n.querySelector(".photo-grid__button").classList.add("photo-grid__button_active"),n.querySelector(".photo-grid__button").addEventListener("click",(function(e){var n;e.target.classList.contains("photo-grid__button_active")?(n=t._id,fetch("".concat(i.url,"/cards/likes/").concat(n),{method:"DELETE",headers:i.headers}).then(u)).then((function(t){e.target.classList.remove("photo-grid__button_active"),c.textContent=t.likes.length})).catch((function(t){console.log("Ошибка: ".concat(t.status))})):function(t){return fetch("".concat(i.url,"/cards/likes/").concat(t),{method:"PUT",headers:i.headers}).then(u)}(t._id).then((function(t){e.target.classList.add("photo-grid__button_active"),c.textContent=t.likes.length})).catch((function(t){console.log("Ошибка: ".concat(t.status))}))})),n.querySelector(".photo-grid__bin").addEventListener("click",(function(t){var e;(e=o.id,fetch("".concat(i.url,"/cards/").concat(e),{method:"DELETE",headers:i.headers}).then(u)).then(onResponse).then((function(t){n.remove()})).catch((function(t){console.log("Ошибка удаления карточки на сервере: ".concat(t.status))}))})),o.addEventListener("click",(function(e){p.src=t.link,p.alt=t.name,f.textContent=t.name,r(d)})),n}var _=document.querySelector(".profile__edit"),v=document.querySelector(".popup-profile"),y=document.querySelector(".popup-profile__form"),S=document.querySelector("#name"),g=document.querySelector("#text"),b=document.querySelector(".popup-add__form"),q=document.querySelector(".profile__title"),L=document.querySelector(".profile__text"),E=document.querySelector(".profile__image"),C=document.querySelector(".profile__add"),k=document.querySelector(".popup-add"),x=document.querySelector(".popup-avatar"),A=document.querySelector(".popup-avatar__form"),w=document.querySelector(".popup-avatar__text"),B=document.querySelector("#addName"),T=document.querySelector("#link"),j=document.querySelectorAll(".popup"),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error"},O=document.querySelector(".profile__image-edit");fetch("".concat(i.url,"/users/me"),{headers:i.headers}).then(u).then((function(t){q.textContent=t.name,L.textContent=t.about,E.src=t.avatar,E.id=t._id,fetch("".concat(i.url,"/cards"),{headers:i.headers}).then(u).then((function(t){t.forEach((function(t){h(m(t,E.id))}))})).catch((function(t){console.log("Ошибка загрузки карточек с сервера: ".concat(t.status))}))})).catch((function(t){console.log("Ошибка загрузки данных профиля с сервера: ".concat(t.status))})),n(D),_.addEventListener("click",(function(){r(v)})),y.addEventListener("submit",(function(t){t.preventDefault(),a(!0,D,v),function(t,e){return fetch("".concat(i.url,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:"".concat(t),about:"".concat(e)})}).then(u)}(S.value,g.value).then((function(){q.textContent=S.value,L.textContent=g.value,c(v)})).catch((function(t){console.log("Ошибка отправки данных профиля на сервер: ".concat(t.status))})).finally((function(t){a(!1,D,v)}))})),C.addEventListener("click",(function(){r(k)})),b.addEventListener("submit",(function(t){var e,n;t.preventDefault(),a(!0,D,k),(e=B.value,n=T.value,fetch("".concat(i.url,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:"".concat(e),link:"".concat(n)})}).then(u)).then((function(e){h(m(e,E.id)),c(k),t.target.reset(),b.querySelector(D.submitButtonSelector).classList.add(D.inactiveButtonClass).disabled="disabled"})).catch((function(t){console.log("Ошибка отправки места на сервер: ".concat(t.status))})).finally((function(t){a(!1,D,k)}))})),n(D),j.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&c(t),e.target.classList.contains("popup__close")&&c(t)}))})),E.addEventListener("mouseover",(function(t){O.classList.add("profile__image-edit_active")})),E.addEventListener("mouseout",(function(t){O.classList.remove("profile__image-edit_active")})),O.addEventListener("mousedown",(function(t){r(x)})),A.addEventListener("submit",(function(t){t.preventDefault(),a(!0,D,x),function(t){return fetch("".concat(i.url,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:"".concat(t)})}).then(u)}(w.value).then((function(t){E.src=t.avatar,c(x)})).catch((function(t){console.log("Ошибка отправки данных профиля на сервер: ".concat(t.status))})).finally((function(t){a(!1,D,x)}))}))})();